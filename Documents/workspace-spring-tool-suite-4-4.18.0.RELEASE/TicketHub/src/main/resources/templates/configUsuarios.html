<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
	<head>
		<meta charset="utf-8">
		<title>Configuracion de Usuarios</title>
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
			integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	
		<!-- Optional theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
			integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
	
		<link rel="stylesheet" type="text/css" href="static/css/style-configUsuarios.css"
			th:href="@{/css/style-configUsuarios.css}">
	</head>
	
	<body>
		<main>
			<nav class="navbar navbar-inverse navbar-fixed-top">
				<div class="container">
					<div class="miNombre">
						<p class="navbar-brand">TICKETHUB</p>
					</div>
					<div id="navbar" class="collapse navbar-collapse">
						<ul class="nav navbar-nav">
							<li sec:authorize="isAuthenticated()">
								<a th:href="@{/logout}">
									<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
										class="bi bi-door-open" viewBox="0 0 16 16">
										<path d="M8.5 10c-.276 0-.5-.448-.5-1s.224-1 .5-1 .5.448.5 1-.224 1-.5 1z" />
										<path
											d="M10.828.122A.5.5 0 0 1 11 .5V1h.5A1.5 1.5 0 0 1 13 2.5V15h1.5a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1H3V1.5a.5.5 0 0 1 .43-.495l7-1a.5.5 0 0 1 .398.117zM11.5 2H11v13h1V2.5a.5.5 0 0 0-.5-.5zM4 1.934V15h6V1.077l-6 .857z" />
									</svg> Cerrar sesión
								</a>
							</li>
	
							<li>
								<a id="mi-enlace" onclick="mostrarMensaje()">
									<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
										class="bi bi-patch-question" viewBox="0 0 16 16">
										<path
											d="M8.05 9.6c.336 0 .504-.24.554-.627.04-.534.198-.815.847-1.26.673-.475 1.049-1.09 1.049-1.986 0-1.325-.92-2.227-2.262-2.227-1.02 0-1.792.492-2.1 1.29A1.71 1.71 0 0 0 6 5.48c0 .393.203.64.545.64.272 0 .455-.147.564-.51.158-.592.525-.915 1.074-.915.61 0 1.03.446 1.03 1.084 0 .563-.208.885-.822 1.325-.619.433-.926.914-.926 1.64v.111c0 .428.208.745.585.745z" />
										<path
											d="m10.273 2.513-.921-.944.715-.698.622.637.89-.011a2.89 2.89 0 0 1 2.924 2.924l-.01.89.636.622a2.89 2.89 0 0 1 0 4.134l-.637.622.011.89a2.89 2.89 0 0 1-2.924 2.924l-.89-.01-.622.636a2.89 2.89 0 0 1-4.134 0l-.622-.637-.89.011a2.89 2.89 0 0 1-2.924-2.924l.01-.89-.636-.622a2.89 2.89 0 0 1 0-4.134l.637-.622-.011-.89a2.89 2.89 0 0 1 2.924-2.924l.89.01.622-.636a2.89 2.89 0 0 1 4.134 0l-.715.698a1.89 1.89 0 0 0-2.704 0l-.92.944-1.32-.016a1.89 1.89 0 0 0-1.911 1.912l.016 1.318-.944.921a1.89 1.89 0 0 0 0 2.704l.944.92-.016 1.32a1.89 1.89 0 0 0 1.912 1.911l1.318-.016.921.944a1.89 1.89 0 0 0 2.704 0l.92-.944 1.32.016a1.89 1.89 0 0 0 1.911-1.912l-.016-1.318.944-.921a1.89 1.89 0 0 0 0-2.704l-.944-.92.016-1.32a1.89 1.89 0 0 0-1.912-1.911l-1.318.016z" />
										<path d="M7.001 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0z" />
									</svg> Ayuda
								</a>
							</li>
	
							<li>
								<a id="mi-enlace" onclick="mostrarOcultar()	">
									<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
										class="bi bi-menu-button" viewBox="0 0 16 16">
										<path
											d="M0 1.5A1.5 1.5 0 0 1 1.5 0h8A1.5 1.5 0 0 1 11 1.5v2A1.5 1.5 0 0 1 9.5 5h-8A1.5 1.5 0 0 1 0 3.5v-2zM1.5 1a.5.5 0 0 0-.5.5v2a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 0-.5-.5h-8z" />
										<path
											d="m7.823 2.823-.396-.396A.25.25 0 0 1 7.604 2h.792a.25.25 0 0 1 .177.427l-.396.396a.25.25 0 0 1-.354 0zM0 8a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V8zm1 3v2a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2H1zm14-1V8a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v2h14zM2 8.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0 4a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z" />
									</svg> Menú
								</a>
							</li>
						</ul>
					</div>
				</div>
			</nav>
			
			<section class="principal" id="imgAdmin">
				<div class="img-admin">
					<div class="Bienvenido">
						<br><span1>Bienvenido</span1>
						<span sec:authorize="isAuthenticated()">[[${nombre}]] [[${apellido}]]</span>
					</div>
	
					<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" fill="currentColor"
						class="bi bi-person-fill" viewBox="0 0 16 16">
						<path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3Zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
					</svg>
					<h1>Gestor</h1>
				</div>
				<br>
				
				<div class="caja">
					<nav>
						<ul1>
							<li1 style="--clr:#033059">
								<a title="Gestionar Prestamo" th:href="@{/#}" data-text="&nbsp;Gestionar Prestamo">
									<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-clipboard2-plus" viewBox="0 0 16 16">
									  <path d="M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5h3Z"/>
									  <path d="M3 2.5a.5.5 0 0 1 .5-.5H4a.5.5 0 0 0 0-1h-.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1H12a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5v-12Z"/>
									  <path d="M8.5 6.5a.5.5 0 0 0-1 0V8H6a.5.5 0 0 0 0 1h1.5v1.5a.5.5 0 0 0 1 0V9H10a.5.5 0 0 0 0-1H8.5V6.5Z"/>
									</svg>&nbsp; Gestionar Prestamo
								</a>
							</li1>
							
							<li1 style="--clr:#033059">
								<a title="Registro de Usuarios" th:href="@{/gestorRegistroDeUsuario}" data-text="&nbsp;Registro de Usuarios">
									<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"
										alt="Registro de Usuarios" fill="currentColor" class="bi bi-person-add"
										viewBox="0 0 16 16">
										<path
											d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0Zm-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" />
										<path
											d="M8.256 14a4.474 4.474 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10c.26 0 .507.009.74.025.226-.341.496-.65.804-.918C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4s1 1 1 1h5.256Z" />
									</svg>&nbsp; Registro de Usuarios
								</a>
							</li1>
							
							<li1 style="--clr:#033059">
								<a title="Configuración de Usuarios" th:href="@{/configUsuarios}"
									data-text="&nbsp;Configuración de Usuarios">
									<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"
										alt="Configuración de Usuarios" fill="currentColor" class="bi bi-person-gear"
										viewBox="0 0 16 16">
										<path
											d="M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm.256 7a4.474 4.474 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10c.26 0 .507.009.74.025.226-.341.496-.65.804-.918C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4s1 1 1 1h5.256Zm3.63-4.54c.18-.613 1.048-.613 1.229 0l.043.148a.64.64 0 0 0 .921.382l.136-.074c.561-.306 1.175.308.87.869l-.075.136a.64.64 0 0 0 .382.92l.149.045c.612.18.612 1.048 0 1.229l-.15.043a.64.64 0 0 0-.38.921l.074.136c.305.561-.309 1.175-.87.87l-.136-.075a.64.64 0 0 0-.92.382l-.045.149c-.18.612-1.048.612-1.229 0l-.043-.15a.64.64 0 0 0-.921-.38l-.136.074c-.561.305-1.175-.309-.87-.87l.075-.136a.64.64 0 0 0-.382-.92l-.148-.045c-.613-.18-.613-1.048 0-1.229l.148-.043a.64.64 0 0 0 .382-.921l-.074-.136c-.306-.561.308-1.175.869-.87l.136.075a.64.64 0 0 0 .92-.382l.045-.148ZM14 12.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0Z" />
									</svg>&nbsp; Configuración de Usuarios
								</a>
							</li1>
							
							<li1 style="--clr:#033059">
								<a title="Inventarios" th:href="@{/#}" data-text="&nbsp;Inventarios">
									<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-folder" viewBox="0 0 16 16">
									  <path d="M.54 3.87.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.826a2 2 0 0 1-1.991-1.819l-.637-7a1.99 1.99 0 0 1 .342-1.31zM2.19 4a1 1 0 0 0-.996 1.09l.637 7a1 1 0 0 0 .995.91h10.348a1 1 0 0 0 .995-.91l.637-7A1 1 0 0 0 13.81 4H2.19zm4.69-1.707A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981l.006.139C1.72 3.042 1.95 3 2.19 3h5.396l-.707-.707z"/>
									</svg>&nbsp; Inventarios
								</a>
							</li1>
						</ul1>
					</nav>
				</div>
			</section>
	
			<section class="segundaria">
				<div class="container1">					
					<div class="tabla">
						<div class="busqueda">
							 <h2>Usuarios Registrados</h2>
							<div class="buscar">
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
								  <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
								</svg>
								<input id="buscarInput" onkeyup="buscarUsuario()" placeholder="Buscar por Nombre...">
							</div>						
						</div>
						<br>
						<div class="wrapper">
						<table class="table table-striped table-bordered" style="background-color:rgba(204, 191, 178, 0.788)">
							
							
							<thead class="table-dark">
								<tr>
									<th>Nombre</th>
									<th>Apellido</th>
									<th>Usuario</th>
									<th>Fecha de Registro</th>
									<th>Editar Datos</th>
									<th>Eliminar</th>
								</tr>
							</thead>
	
							<tbody>
								<tr th:each="usuario : ${usuarios_externos}">
									<th:block
										th:if="${usuario.username != 'prueba.admin@gmail.co' && usuario.username != 'admin@ucooperativa.edu.co'}">
										<td th:text="${usuario.nombre}">ID</td>
										<td th:text="${usuario.apellido}">ID</td>
										<td th:text="${usuario.username}">ID</td>
										<td th:text="${#temporals.format(usuario.fechaDeRegistro, 'yyyy-MM-dd HH:mm:ss')}">ID</td>
										<td>
											<button class="toggle-btn">Editar Datos</button>
												<form class="user-form" th:action="@{/modificar-usuario}" method="post"
													style="display:none"
													onsubmit="return confirm('¿Está seguro de almacenar los cambios realizados?')">
		
													<br>
													<input type="hidden" name="id" th:value="${usuario.id}" />
		
													<h6>Nombre:</h6>
													<input type="text" name="nombre" th:value="${usuario.nombre}"
														onchange="validateNombre(this)" required autofocus="autofocus" />
		
													<script>
														function validateNombre(input) {
															const regex = /^[a-zA-Z\u00C0-\u017F ]*$/;
															if (!regex.test(input.value)) {
																alert("El nombre solo debe contener letras (Se permiten las tíldes).");
																input.value = "";
															}
														}
		
													</script>
													
													<h6>Apellido:</h6>
													<input type="text" name="apellido" th:value="${usuario.apellido}"
														onchange="validateApellido(this)" required autofocus="autofocus" />
														
													<script>
														function validateApellido(input) {
															const regex = /^[a-zA-Z\u00C0-\u017F ]*$/;
															if (!regex.test(input.value)) {
																alert("El Apellido solo debe contener letras (Se permiten las tildes).");
																input.value = "";
															}
														}
													</script>
		
													<h6>Usuario:</h6>
		
													<input type="email" name="username" th:value="${usuario.username}"
														onchange="validateUser(this)" required autofocus="autofocus"
														maxlength="30" />
		
													<script>
														function validateUser(input) {
															const regex = /^[a-zA-Z][a-zA-Z0-9]*@[^\s@]+\.[^\s@]+$/;
															if (!regex.test(input.value)) {
																alert('El usuario debe ser en formato de correo electrónico, no debe empezar por números ni caracteres y pertenecer al dominio @ucooperativa.edu.co \nEjemplo: "ejemplo@ucooperativa.edu.co"');
																input.value = "";
															} else if (input.value.length > 70) {
																alert('El usuario debe tener una longitud máxima de 70 caracteres.');
																input.value = input.value.substring(0, 70);
															} else if (!input.value.endsWith('@ucooperativa.edu.co')) {
																alert('El Usuario debe pertenecer al dominio @ucooperativa.edu.co');
																input.value = "";
															}
														}
													</script>
		
													<input type="hidden" name="password" th:value="${usuario.password}" />
													<br><br>
													<button type="submit" class="btn btn-danger">
														<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
															fill="currentColor" class="bi bi-bookmark-check-fill"
															viewBox="0 0 16 16">
															<path fill-rule="evenodd"
																d="M2 15.5V2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.74.439L8 13.069l-5.26 2.87A.5.5 0 0 1 2 15.5zm8.854-9.646a.5.5 0 0 0-.708-.708L7.5 7.793 6.354 6.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3z" />
														</svg> Guardar Cambios</button>
												</form>
												
											<script>
	
												// Obtenemos el formulario de eliminación de usuario por su id
												const modificarUsuarioForm = document.getElementById('modificar-usuario');
	
												// Agregamos un event listener para el evento "submit"
												modificarUsuarioForm.addEventListener('submit', (event) => {
													// Prevenimos el comportamiento por defecto de enviar el formulario
													event.preventDefault();
	
													// Mostramos una alerta de confirmación para asegurarnos de que el usuario desea eliminar al usuario
	
													if (confirm('¿Está seguro de almacenar los cambios realizados? Esta acción no se puede deshacer.')) {
														// Si el usuario confirma, enviamos el formulario
														modificarUsuarioForm.submit();
													}
	
												});
											</script>
										</td>
	
										<td>
											<form th:action="@{/eliminar-usuario}" method="post"
												onsubmit="return confirm('¿Está seguro de eliminar este Gestor?')">
												<input type="hidden" name="id" th:value="${usuario.id}" />
												<button type="submit" class="btn btn-danger">
													<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
														fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
														<path
															d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z" />
														<path
															d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z" />
													</svg> Eliminar
												</button>
											</form>
										</td>
									</th:block>
								</tr>
							</tbody>
	
							<script>
								const toggleBtns = document.querySelectorAll('.toggle-btn');
								toggleBtns.forEach(toggleBtn => {
									toggleBtn.addEventListener('click', () => {
										const userForm = toggleBtn.parentNode.querySelector('.user-form');
										if (userForm.style.display === 'none') {
											userForm.style.display = 'block';
											toggleBtn.innerHTML = 'Cancelar';
	
											const cancelBtn = toggleBtn.parentNode.querySelector('.toggle-btn');
											cancelBtn.addEventListener('click', () => {
												window.location.href = 'configUsuarios';
											});
	
										} else {
											userForm.style.display = 'none';
											toggleBtn.innerHTML = 'Editar Datos';
										}
									});
								});
							</script>
						</table>
						</div>
					</div>
				</div>
			</section>
		</main>
	
		<footer>
			<h1>© Universidad Cooperativa</h1>
		</footer>
		
		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
			integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
			crossorigin="anonymous"></script>
			
			<script th:src="@{/js/script-configUsuarios.js}"></script>
	</body>
</html>